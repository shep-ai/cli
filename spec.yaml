# Feature Specification (YAML)
# This is the source of truth. Markdown is auto-generated from this file.

name: merge-review-drawer
number: 036
branch: feat/merge-review-drawer
oneLiner: Add merge review drawer and feature node visualization for the Review lifecycle phase
summary: >
  When a feature reaches the merge approval gate (lifecycle=Review, state=action-required),
  the feature node needs a distinct visual badge (emerald/GitMerge) and a dedicated merge
  review drawer displaying PR metadata, diff summary, and CI status with an approve action.
  The drawer follows the established ReviewDrawerShell composition pattern, reads data from
  Feature.pr with on-demand diff regeneration, and gracefully degrades when diff stats are
  unavailable.
phase: Requirements
sizeEstimate: M

# Relationships
relatedFeatures: []

technologies:
  - React 19 (Next.js 16+ App Router)
  - shadcn/ui (Radix + Tailwind CSS v4)
  - React Flow (@xyflow/react)
  - Storybook
  - Vaul (drawer primitive)
  - LangGraph (interrupt/resume for approval gates)
  - Lucide React (GitMerge / GitPullRequest icons)
  - sonner (toast notifications)
  - tsyringe (DI container for server actions)

relatedLinks: []

# Open questions (resolved with AI recommendations)
openQuestions:
  - question: >
      The merge interrupt payload (diffSummary, prUrl, prNumber) is stored only in the
      LangGraph checkpoint, not persisted to the Feature or AgentRun entity. Should we
      (A) add an interruptPayload field to AgentRun and persist it when status becomes
      waitingApproval, or (B) create a use case that reads the checkpoint directly, or
      (C) read the Feature.pr field (which is populated before the interrupt in merge.node.ts
      lines 144-158) and generate the diff summary on demand via a new server action?
    impact: Determines the data access architecture for the merge drawer content.
    resolved: true
    options:
      - option: 'Persist interruptPayload on AgentRun'
        description: >
          Add a new interruptPayload JSON field to AgentRun and persist the merge interrupt
          data when status becomes waitingApproval. Pros: single source of truth, no
          recomputation. Cons: requires TypeSpec model change, migration, and changes to
          the worker persistence layer — high blast radius for a display-only feature.
        selected: false
      - option: 'Read LangGraph checkpoint directly'
        description: >
          Create a use case that reads the LangGraph checkpoint to extract the interrupt
          payload. Pros: no model changes. Cons: couples the UI data layer to LangGraph
          internals, checkpoint format may change, adds complexity to the read path.
        selected: false
      - option: 'Read Feature.pr + regenerate diff summary'
        description: >
          Create a new server action that reads Feature.pr for PR metadata (url, number,
          status, commitHash, ciStatus) and calls gitPrService.getPrDiffSummary() for
          diff statistics. Pros: uses already-persisted data, no model changes, follows
          existing server action patterns, diff summary is always fresh. Cons: requires
          the worktree to still exist for diff computation (which it does during review).
        selected: true
    selectionRationale: >
      Option C is recommended because Feature.pr is already populated before the interrupt
      (merge.node.ts:144-158) and contains all PR metadata. The diff summary can be
      regenerated on demand via the existing IGitPrService.getPrDiffSummary() method.
      This avoids any domain model changes, follows the established server action pattern
      (like get-feature-artifact.ts and get-research-artifact.ts), and keeps the diff
      data fresh. The worktree is guaranteed to exist during the Review lifecycle phase.
    answer: 'Read Feature.pr + regenerate diff summary'

  - question: >
      What color scheme and icon should the merge review badge use on the feature node
      to distinguish it from requirements (amber/FileText) and implementation (indigo/Wrench)?
    impact: Determines the visual identity of the merge review state in the canvas.
    resolved: true
    options:
      - option: 'Green with GitMerge icon'
        description: >
          Use green (emerald) color scheme with the GitMerge icon from Lucide React.
          Green conveys "ready to merge / success", GitMerge directly represents the
          action. Consistent with GitHub's merge button color. Distinct from amber
          (requirements) and indigo (implementation).
        selected: true
      - option: 'Purple with GitPullRequest icon'
        description: >
          Use purple/violet color scheme with GitPullRequest icon. Purple is visually
          distinct but doesn't carry semantic meaning related to merging. GitPullRequest
          represents the PR itself rather than the merge action.
        selected: false
      - option: 'Teal with GitMerge icon'
        description: >
          Use teal/cyan color scheme with GitMerge icon. Teal is distinct from existing
          colors but less semantically meaningful than green for a merge action.
        selected: false
    selectionRationale: >
      Green (emerald) with GitMerge is recommended because it creates an intuitive visual
      language: green = ready to proceed/merge, matching GitHub's merge button convention.
      The GitMerge icon directly communicates the action being reviewed. The three review
      states form a clear progression: amber (requirements) → indigo (implementation) →
      green (merge), each visually distinct and semantically meaningful.
    answer: 'Green with GitMerge icon'

  - question: >
      Should the merge review drawer include a reject/request-changes action in addition
      to approve, and if so what should happen on rejection?
    impact: Determines the drawer action buttons and the rejection flow.
    resolved: true
    options:
      - option: 'Approve only (with delete as escape hatch)'
        description: >
          Only show an Approve button. Users who don't want to merge can delete the
          feature or close the drawer and leave it pending. Simple, matches the existing
          PRD/Tech drawer pattern which only has approve. The ReviewDrawerShell already
          provides a delete button for abandoning features.
        selected: true
      - option: 'Approve + Reject with agent feedback loop'
        description: >
          Add a Reject button that sends feedback to the agent, which would then revise
          the PR. Requires new LangGraph interrupt response handling, new domain model
          fields, and significant backend work. More complete UX but high implementation
          cost and out of scope for an M-sized feature.
        selected: false
    selectionRationale: >
      Approve-only is recommended to match the established pattern used by PRD and Tech
      Decision drawers. The ReviewDrawerShell already provides delete as an escape hatch
      for abandoning a feature. Adding rejection would require significant backend changes
      to the LangGraph interrupt/resume flow, which is out of scope. A reject flow can be
      added as a separate feature if needed.
    answer: 'Approve only (with delete as escape hatch)'

  - question: >
      Should the merge review drawer content include a chat input for refinement feedback
      (like PRD and Tech drawers) or only display read-only PR information with an approve action?
    impact: Determines whether the drawer supports conversational refinement before approval.
    resolved: true
    options:
      - option: 'Read-only display with approve action'
        description: >
          Show PR metadata, diff summary, and CI status as read-only content with an
          approve button. No chat input. Merge review is a binary decision (approve or
          not) — there's nothing to "refine" like requirements or tech decisions. Simpler
          to implement and matches the nature of the merge gate.
        selected: true
      - option: 'Include chat input for feedback'
        description: >
          Include a chat input like the other drawers for consistency. Users could send
          feedback that gets passed to the agent. However, the merge node doesn't currently
          support feedback-based revision, so the chat input would be non-functional or
          require backend changes.
        selected: false
    selectionRationale: >
      Read-only is recommended because merge review is fundamentally a binary approval
      decision, unlike requirements (where users select options) or tech decisions (where
      users can request plan revisions). The merge node's interrupt flow doesn't support
      feedback-based revision. Adding a non-functional chat input would be misleading.
      The PR link provides an escape hatch for users who want to review code in detail
      on GitHub.
    answer: 'Read-only display with approve action'

  - question: >
      How should the drawer handle the case where the worktree has been deleted or the
      git repository is unavailable, making diff summary regeneration impossible?
    impact: Determines error handling and fallback behavior for the merge drawer.
    resolved: true
    options:
      - option: 'Graceful degradation with PR-only fallback'
        description: >
          If diff summary fails, show PR metadata from Feature.pr (URL, number, status,
          CI status) without diff stats. Display a subtle warning that diff stats are
          unavailable. The approve action still works since it only needs the agentRunId.
          Low implementation cost, good UX.
        selected: true
      - option: 'Block drawer with error state'
        description: >
          Show a full error state in the drawer when diff summary fails. Prevents users
          from seeing partial data. However, blocking approval because of a display issue
          would be frustrating — the user can always review the PR on GitHub.
        selected: false
    selectionRationale: >
      Graceful degradation is recommended because the diff summary is supplementary
      information — the core action (approve merge) doesn't depend on it. Feature.pr
      data is already persisted and always available. Blocking the entire drawer because
      of a transient git error would frustrate users unnecessarily. The PR URL provides
      a direct link to review changes on GitHub regardless.
    answer: 'Graceful degradation with PR-only fallback'

  - question: >
      Should the diff summary section display file-level change details (list of changed files
      with per-file additions/deletions) or only aggregate statistics?
    impact: Determines the granularity of diff information shown in the drawer and server action complexity.
    resolved: true
    options:
      - option: 'Aggregate statistics only'
        description: >
          Show total files changed, total additions, total deletions, and commit count.
          Matches the DiffSummary interface already returned by IGitPrService.getPrDiffSummary().
          No additional API calls or interface changes needed. Users who want file-level
          details can click the PR link to view on GitHub.
        selected: true
      - option: 'File-level details with per-file stats'
        description: >
          Show a list of each changed file with individual addition/deletion counts.
          Richer information but requires extending IGitPrService with a new method or
          modifying getPrDiffSummary() to return per-file data. Increases server action
          complexity and drawer layout complexity.
        selected: false
    selectionRationale: >
      Aggregate statistics are recommended because the existing IGitPrService.getPrDiffSummary()
      already returns exactly this data shape (filesChanged, additions, deletions, commitCount).
      No interface changes needed. The merge drawer's purpose is to provide a quick approval
      decision, not a full code review — GitHub serves that purpose and is linked from the PR URL.
    answer: 'Aggregate statistics only'

  - question: >
      How should CI status be visually represented in the merge review drawer?
    impact: Determines the CI status display pattern and how users assess merge readiness.
    resolved: true
    options:
      - option: 'Color-coded badge with icon'
        description: >
          Display CI status as a colored badge: green/CheckCircle for Success, yellow/Loader
          for Pending, red/XCircle for Failure. Follows GitHub's visual language for CI
          status. Compact and immediately scannable. Uses existing shadcn/ui Badge component
          with Lucide icons.
        selected: true
      - option: 'Text-only status line'
        description: >
          Display CI status as plain text ("CI: Passing", "CI: Pending", "CI: Failing")
          without color coding. Simpler but loses the visual immediacy of color-coded
          indicators. Less consistent with GitHub's UI patterns.
        selected: false
    selectionRationale: >
      Color-coded badges with icons are recommended because they provide instant visual
      feedback on merge readiness. Success (green), Pending (yellow), and Failure (red)
      follow universal CI/CD conventions. This matches GitHub's own status indicator pattern
      which users are already familiar with.
    answer: 'Color-coded badge with icon'

content: |
  ## Problem Statement

  When a feature's agent reaches the merge phase and requires approval (`allowMerge=false`),
  the agent interrupts and sets the feature to `lifecycle=Review` with
  `agentRun.status=waiting_approval`. Currently, the web UI has no dedicated handling for
  this state combination:

  1. **Feature node**: The `getBadgeText()` function in `feature-node.tsx:51-54` has no
     specific case for `lifecycle === 'review'` when `state === 'action-required'` — it falls
     through to the generic "User action required" label.

  2. **Feature node badge color**: The `getActionRequiredBadgeClasses()` function only handles
     `implementation` (indigo) — `review` falls through to the default amber, making it
     indistinguishable from PRD review.

  3. **No merge drawer**: The `control-center-inner.tsx` only checks for `showPrdDrawer`
     (requirements + action-required) and `showTechDecisionsDrawer` (implementation +
     action-required). There is no `showMergeReviewDrawer` condition for `review +
     action-required`.

  4. **No merge drawer component**: Unlike `prd-questionnaire/` and `tech-decisions-review/`,
     there is no `merge-review/` component directory.

  5. **FeatureDrawer exclusion**: The standard `FeatureDrawer` already excludes PRD and Tech
     drawers (`showPrdDrawer || showTechDecisionsDrawer ? null : selectedNode`) but does not
     account for the merge review state.

  ## Success Criteria

  - [ ] Feature node displays "Review Merge Request" badge text when lifecycle=review and state=action-required
  - [ ] Feature node badge uses emerald (green) color scheme with GitMerge icon for review + action-required state
  - [ ] Feature node badge is visually distinct from requirements (amber/FileText) and implementation (indigo/Wrench) badges
  - [ ] Clicking a feature node in review + action-required state opens the merge review drawer (not the generic FeatureDrawer)
  - [ ] Merge review drawer displays PR number with clickable link to GitHub PR URL
  - [ ] Merge review drawer displays PR status (Open/Merged/Closed) as a visible indicator
  - [ ] Merge review drawer displays CI status (Pending/Success/Failure) with color-coded badge and icon when available
  - [ ] Merge review drawer displays diff summary statistics (files changed, additions, deletions, commit count) when available
  - [ ] Merge review drawer shows graceful fallback with PR metadata only when diff summary is unavailable
  - [ ] Merge review drawer provides a working "Approve Merge" button that resumes the agent via the existing approveFeature() server action
  - [ ] Approve action shows success toast "Merge approved — agent resuming" and closes the drawer
  - [ ] Approve action shows error toast on failure without closing the drawer
  - [ ] Merge review drawer integrates ReviewDrawerShell with header, feature actions menu, and delete action
  - [ ] Generic FeatureDrawer is suppressed when the merge review drawer is active
  - [ ] The `merge` node name maps to the `review` lifecycle phase in page.tsx nodeToLifecyclePhase
  - [ ] All new components have colocated Storybook stories with multiple variant coverage
  - [ ] All Storybook stories render without errors
  - [ ] TypeScript type checking passes (pnpm typecheck:web)
  - [ ] ESLint passes with no new warnings (pnpm lint:web)
  - [ ] All existing tests continue to pass (pnpm test)

  ## Functional Requirements

  ### Feature Node Visualization

  - **FR-1**: When a feature has `lifecycle='review'` and `state='action-required'`, the feature node badge MUST display the text "Review Merge Request".
  - **FR-2**: The feature node badge for review + action-required state MUST use the `GitMerge` icon from Lucide React.
  - **FR-3**: The feature node badge for review + action-required state MUST use an emerald (green) color scheme (`text-emerald-700` badge text, `bg-emerald-50` badge background) to distinguish it from requirements (amber) and implementation (indigo).
  - **FR-4**: The `nodeToLifecyclePhase` map in `page.tsx` MUST include the entry `merge: 'review'` so that the merge agent node correctly maps to the review lifecycle phase.

  ### Merge Review Drawer — Data Retrieval

  - **FR-5**: A new server action `getMergeReviewData(featureId)` MUST fetch the Feature entity via `IFeatureRepository.findById()`, extract the `Feature.pr` field for PR metadata (url, number, status, commitHash, ciStatus), and return it to the client.
  - **FR-6**: The server action MUST attempt to fetch diff summary statistics via `IGitPrService.getPrDiffSummary(worktreePath, baseBranch)` and include them in the response when successful.
  - **FR-7**: If diff summary retrieval fails (worktree deleted, git error), the server action MUST still return PR metadata successfully with the diff summary omitted and an optional error message indicating why diff stats are unavailable.
  - **FR-8**: The server action MUST return a structured error `{ error: string }` if the feature is not found or has no PR data.
  - **FR-9**: The server action MUST validate the featureId input (non-empty string) before processing.

  ### Merge Review Drawer — Content Display

  - **FR-10**: The merge review drawer MUST display the PR number (e.g., "PR #42") as a clickable external link that opens the GitHub PR URL in a new tab.
  - **FR-11**: The merge review drawer MUST display the PR status (Open, Merged, Closed) as a visible text indicator.
  - **FR-12**: The merge review drawer MUST display the CI status using a color-coded badge with an icon: green/CheckCircle2 for Success, yellow/Loader2 for Pending, red/XCircle for Failure. If CI status is not available, the CI section MUST be omitted (not shown as empty).
  - **FR-13**: The merge review drawer MUST display aggregate diff summary statistics when available: files changed count, additions count (with "+" prefix), deletions count (with "-" prefix), and commit count.
  - **FR-14**: When diff summary is unavailable but PR metadata exists, the drawer MUST display a subtle warning message (e.g., "Diff statistics unavailable") instead of the diff section, without blocking any other functionality.
  - **FR-15**: The merge review drawer MUST display the commit hash (truncated to 7 characters) when available in the PR metadata.

  ### Merge Review Drawer — Actions

  - **FR-16**: The merge review drawer MUST provide an "Approve Merge" button that calls the existing `approveFeature(featureId)` server action to resume the agent.
  - **FR-17**: On successful approval, the drawer MUST show a success toast notification ("Merge approved — agent resuming"), close the drawer, and clear the node selection.
  - **FR-18**: On failed approval, the drawer MUST show an error toast notification with the error message and keep the drawer open for retry.
  - **FR-19**: The "Approve Merge" button MUST show a processing/disabled state while the approval request is in flight to prevent double submissions.

  ### Merge Review Drawer — Shell Integration

  - **FR-20**: The merge review drawer MUST use the `ReviewDrawerShell` component as its wrapper, providing the feature name, description, ID, repository path, branch, and spec path for the header and action menu.
  - **FR-21**: The merge review drawer MUST support the delete action via `ReviewDrawerShell`'s built-in delete button with confirmation dialog.

  ### Control Center Integration

  - **FR-22**: The control center MUST derive `showMergeReviewDrawer = true` when the selected node has `lifecycle='review'` AND `state='action-required'`.
  - **FR-23**: When `showMergeReviewDrawer` is true, the control center MUST fetch merge review data via the server action and render the `MergeReviewDrawer` component.
  - **FR-24**: When `showMergeReviewDrawer` is true, the generic `FeatureDrawer` MUST be suppressed (selectedNode passed as null).
  - **FR-25**: The control center MUST use a `useEffect` with a cancellation pattern (consistent with PRD and Tech drawer data fetching) to load merge review data when the drawer becomes visible, and reset data when the selected node changes.

  ### Storybook Coverage

  - **FR-26**: The merge review content component MUST have a colocated `.stories.tsx` file with at minimum the following variants: default (all data present), CI pending, CI failure, no diff summary (degraded), no CI status, and processing/loading state.
  - **FR-27**: The feature node stories MUST include a variant for the review + action-required state showing the emerald badge with GitMerge icon.
  - **FR-28**: The control center stories MUST include a variant showing the merge review drawer in the open state.

  ## Non-Functional Requirements

  - **NFR-1 (Pattern Consistency)**: The merge review drawer component directory MUST follow the established 5-file pattern: `merge-review-config.ts` (interfaces), `merge-review.tsx` (content), `merge-review-drawer.tsx` (shell wrapper), `merge-review.stories.tsx` (stories), `index.ts` (barrel export).
  - **NFR-2 (Performance)**: The server action MUST return within 2 seconds for the PR metadata path. Diff summary retrieval is best-effort and MUST NOT block the response if it fails — the action should return PR data with diffSummary omitted rather than timing out.
  - **NFR-3 (Accessibility)**: The PR URL link MUST open in a new tab with `target="_blank"` and `rel="noopener noreferrer"`. The approve button MUST be keyboard-accessible and have appropriate aria labels. Color-coded CI badges MUST include text labels (not color-only indicators).
  - **NFR-4 (Type Safety)**: All component props, server action inputs/outputs, and data interfaces MUST be fully typed in TypeScript with no `any` types. The `MergeReviewData` interface MUST use the existing generated types (`PrStatus`, `CiStatus`) from `@shepai/core/domain/generated/output`.
  - **NFR-5 (Error Isolation)**: A failure in the diff summary retrieval MUST NOT prevent the drawer from rendering PR metadata or the approve action from functioning. Error boundaries must be scoped so that a server action failure shows a toast, not a white screen.
  - **NFR-6 (Code Organization)**: The merge review component directory MUST live at `components/common/merge-review/` (Tier 1, shared domain component) consistent with `prd-questionnaire/` and `tech-decisions-review/` placement.
  - **NFR-7 (No Backend Changes)**: This feature MUST NOT require any changes to domain models, TypeSpec definitions, database migrations, or backend infrastructure. All data is sourced from existing persisted fields and service interfaces.
  - **NFR-8 (Bundle Size)**: The merge review drawer MUST NOT introduce any new npm dependencies. All required icons (GitMerge, CheckCircle2, XCircle, Loader2, ExternalLink) are already available in the lucide-react package. All UI primitives are already installed via shadcn/ui.

  ## Product Questions & AI Recommendations

  | # | Question | AI Recommendation | Rationale |
  | - | -------- | ----------------- | --------- |
  | 1 | Data access architecture for merge drawer content? | Read Feature.pr + regenerate diff summary | Avoids domain model changes, uses already-persisted PR data, follows existing server action patterns, diff is always fresh |
  | 2 | Badge color and icon for merge review state? | Green (emerald) with GitMerge icon | Matches GitHub's merge button convention, forms clear amber → indigo → green progression across review types |
  | 3 | Should drawer include reject/request-changes? | Approve only (with delete as escape hatch) | Matches existing PRD/Tech drawer pattern, reject would require significant backend changes out of scope |
  | 4 | Should drawer include chat input for refinement? | Read-only display with approve action | Merge review is binary approval, merge node doesn't support feedback revision, chat would be misleading |
  | 5 | How to handle unavailable diff summary? | Graceful degradation with PR-only fallback | Diff is supplementary, PR data is always available, blocking approval over display issue frustrates users |
  | 6 | Aggregate stats vs file-level diff details? | Aggregate statistics only | Matches existing DiffSummary interface, no API changes needed, GitHub link covers detailed review |
  | 7 | How to display CI status visually? | Color-coded badge with icon | Instant visual feedback, follows universal CI/CD conventions, matches GitHub status indicator pattern |

  ## Affected Areas

  | Area | Impact | Reasoning |
  | ---- | ------ | --------- |
  | `components/common/feature-node/feature-node.tsx` (242 lines) | Medium | Add `review` lifecycle case to `getBadgeText()`, `getBadgeIcon()`, and `getActionRequiredBadgeClasses()` — three small additions (~5-10 lines each) |
  | `components/common/merge-review/` (NEW) | High | New directory with 5 files: config (~30 lines), content component (~120 lines), drawer wrapper (~35 lines), stories (~150 lines), barrel export (~5 lines) |
  | `components/features/control-center/control-center-inner.tsx` (262 lines) | Medium | Add `showMergeReviewDrawer` boolean, merge data state, `useEffect` for data fetch, approval handler, and conditional rendering — follows existing PRD/Tech pattern exactly |
  | `app/actions/get-merge-review-data.ts` (NEW) | Medium | New server action (~50 lines) resolving Feature via DI, reading Feature.pr, calling `getPrDiffSummary()` with graceful fallback |
  | `app/page.tsx` (144 lines) | Low | Add single entry `merge: 'review'` to `nodeToLifecyclePhase` map |
  | `components/common/feature-node/feature-node.stories.tsx` | Low | Add story variant for review + action-required state |
  | `components/features/control-center/control-center.stories.tsx` (302 lines) | Low | Add story variant showing merge review drawer open |
  | `components/common/feature-node/feature-node-state-config.ts` (143 lines) | None | `review` lifecycle phase already defined — no changes needed |
  | `components/common/feature-node/derive-feature-state.ts` (83 lines) | None | State derivation already handles review correctly — no changes needed |

  ## Dependencies

  **Existing components to reuse (no modifications needed):**
  - `ReviewDrawerShell` (143 lines) — shared drawer shell with header, delete action, feature actions menu
  - `useFeatureActions` hook (139 lines) — IDE/shell/folder actions, already used by ReviewDrawerShell
  - `approveFeature()` server action (38 lines) — works for all approval gates including merge
  - `resolve()` from `lib/server-container.ts` (36 lines) — DI resolution for server actions

  **Domain types already available in `packages/core/src/domain/generated/output.ts`:**
  - `PullRequest` — `{ url: string, number: number, status: PrStatus, commitHash?: string, ciStatus?: CiStatus }`
  - `PrStatus` enum — `Open | Merged | Closed`
  - `CiStatus` enum — `Pending | Success | Failure`
  - `SdlcLifecycle` enum — includes `Review` value
  - `ApprovalGates` — `{ allowPrd, allowPlan, allowMerge }`

  **Service interfaces to use (read-only, no modifications):**
  - `IFeatureRepository.findById(id)` — fetch Feature with populated `pr` field
  - `IGitPrService.getPrDiffSummary(cwd, baseBranch)` — returns `DiffSummary { filesChanged, additions, deletions, commitCount }`

  **Backend infrastructure (no changes needed):**
  - `merge.node.ts` (194 lines) — sets `Feature.pr` before interrupt at lines 144-158, passes `diffSummary` in interrupt payload
  - `feature-agent-worker.ts` — sets `AgentRunStatus.waitingApproval` on interrupt
  - `ApproveAgentRunUseCase` — resumes the LangGraph agent from interrupt, works for merge gate

  ## Size Estimate

  **M (2-3 days)** — This feature is well-scoped and follows established patterns exactly:

  - **New files (~6):** `merge-review-config.ts`, `merge-review.tsx`, `merge-review-drawer.tsx`, `merge-review.stories.tsx`, `index.ts`, `get-merge-review-data.ts` server action
  - **Modified files (~3):** `feature-node.tsx` (3 small function additions), `control-center-inner.tsx` (drawer integration following existing pattern), `page.tsx` (1 map entry)
  - **Story additions (~2):** Feature node review variant, control center merge drawer variant
  - **No domain model changes**, no TypeSpec modifications, no migrations, no backend changes
  - **Risk is low** because every pattern is already proven in PRD and Tech Decision drawers
  - TDD cycles add ~30% overhead but all test boundaries are clear

  ---

  _Requirements completed — proceed with research_
