# Feature Specification (YAML)
# This is the source of truth. Markdown is auto-generated from this file.

name: auto-git-init
number: 039
branch: feat/039-auto-git-init
oneLiner: Auto-initialize git repos for non-git directories during feature creation
summary: >
  When CreateFeatureUseCase runs against a directory that is not a git repository,
  automatically run `git init` with an initial empty commit so that worktree creation
  and the rest of the feature flow succeed without manual intervention. Add an
  integration test suite that exercises this flow with real git commands in isolated
  temporary directories.
phase: Requirements
sizeEstimate: S

# Relationships
relatedFeatures:
  - '036-repository-entity'

technologies:
  - TypeScript
  - node:child_process (execFile)
  - Vitest

relatedLinks: []

# Open questions (must be resolved before implementation)
openQuestions: []

# Markdown content (the actual spec)
content: |
  ## Problem Statement

  The `CreateFeatureUseCase` depends on git worktree operations which require an
  initialized git repository with at least one commit. When a user runs `shep feat new`
  in a plain directory (no `.git`), the use case fails with a raw git error
  (`fatal: not a git repository`) instead of gracefully handling the situation.

  This is a common scenario for new projects where a user wants Shep to scaffold
  features before they've set up version control.

  ## Success Criteria

  - [ ] `CreateFeatureUseCase` succeeds when run against a non-git directory
  - [ ] Git repo is automatically initialized with an empty initial commit
  - [ ] Existing git repositories are not re-initialized or modified
  - [ ] Integration test validates the full flow with real git commands in an isolated temp dir
  - [ ] Error messages are clear if git initialization itself fails

  ## Affected Areas

  | Area | Impact | Reasoning |
  | ---- | ------ | --------- |
  | WorktreeService / Git service layer | Medium | New `ensureGitRepository` method added |
  | CreateFeatureUseCase | Low | Calls ensure method before worktree creation |
  | Integration tests | Medium | New test suite with real git operations |

  ## Dependencies

  Requires `git` to be installed on the host system (already a prerequisite for worktrees).

  ## Size Estimate

  **S** - Small, focused change: one new service method, one use case modification,
  one integration test file. No domain model changes, no UI changes.

  ---

  _Generated by `/shep-kit:new-feature-fast`_
