# Task Breakdown (YAML)
# This is the source of truth. Markdown is auto-generated from this file.

name: control-center
summary: Task breakdown for 016-control-center

# Relationships
relatedFeatures:
  - '015-feature-flow-canvas'
  - '013-ui-arch'
technologies:
  - '@xyflow/react ^12.10.0'
  - React 19
  - Tailwind CSS v4
  - shadcn/ui
  - Storybook 8
  - Lucide React
relatedLinks:
  - https://reactflow.dev/api-reference/components/panel
  - https://reactflow.dev/api-reference/hooks/use-on-selection-change

# Structured task list
tasks:
  - id: task-1
    title: 'Scaffold control-center directory structure'
    description: >
      Create the features/control-center/ directory with empty component shells,
      TypeScript interfaces, and barrel exports. All files should compile with
      pnpm typecheck:web.
    state: Todo
    dependencies: []
    acceptanceCriteria:
      - 'Directory features/control-center/ exists with all 5 files'
      - 'index.ts barrel exports all components and types'
      - 'pnpm typecheck:web passes with placeholder implementations'
    tdd: null
    estimatedEffort: S

  - id: task-2
    title: 'Add selected visual highlight to FeatureNode [P]'
    description: >
      Add a ring-2 ring-primary highlight to FeatureNode when the selected prop
      is true. React Flow passes selected as a prop to all custom nodes. Update
      Storybook stories with a Selected variant.
    state: Todo
    dependencies:
      - task-1
    acceptanceCriteria:
      - 'FeatureNode renders ring-2 ring-primary when selected=true'
      - 'FeatureNode does NOT render ring classes when selected=false'
      - 'Ring does not conflict with existing left border styling'
      - 'Storybook has Selected variant for each state'
      - 'Unit test verifies conditional ring class application'
    tdd:
      red:
        - 'Write test: FeatureNode renders ring-2 ring-primary when selected=true'
        - 'Write test: FeatureNode does NOT render ring classes when selected=false'
      green:
        - 'Add conditional cn() class: ring-2 ring-primary when selected prop is true'
      refactor:
        - 'Verify ring integrates cleanly with existing border-l-4 styles'
        - 'Add Selected story variant to feature-node.stories.tsx'
    estimatedEffort: S

  - id: task-3
    title: 'Extend FeaturesCanvas with interaction callbacks [P]'
    description: >
      Add onNodeClick and onPaneClick callback props to FeaturesCanvasProps.
      Pass them through to the underlying ReactFlow component. Update stories.
    state: Todo
    dependencies:
      - task-1
    acceptanceCriteria:
      - 'FeaturesCanvasProps includes onNodeClick and onPaneClick'
      - 'Callbacks are passed through to ReactFlow component'
      - 'Existing stories still render correctly'
      - 'New Interactive story demonstrates callback usage'
      - 'Unit test verifies callback prop pass-through'
    tdd:
      red:
        - 'Write test: FeaturesCanvas accepts onNodeClick prop'
        - 'Write test: FeaturesCanvas accepts onPaneClick prop'
      green:
        - 'Add onNodeClick and onPaneClick to FeaturesCanvasProps interface'
        - 'Pass callbacks to <ReactFlow> component'
      refactor:
        - 'Update type exports in index.ts'
        - 'Add Interactive story variant to features-canvas.stories.tsx'
    estimatedEffort: S

  - id: task-4
    title: 'Implement useControlCenterState hook'
    description: >
      Build the central state management hook that composes React Flow hooks
      (useOnSelectionChange) with local state for selection tracking and
      handles Escape keyboard shortcut.
    state: Todo
    dependencies:
      - task-2
      - task-3
    acceptanceCriteria:
      - 'Hook returns selectedNode (FeatureNodeData | null)'
      - 'Hook returns clearSelection function'
      - 'Escape key clears selection'
      - 'useOnSelectionChange callback is memoized with useCallback'
      - 'All tests pass'
    tdd:
      red:
        - 'Write test: returns selectedNode when FeatureNode selected'
        - 'Write test: returns null selectedNode when no selection'
        - 'Write test: Escape key clears selection'
      green:
        - 'Implement useOnSelectionChange to track selected node'
        - 'Add useEffect with keydown listener for Escape'
      refactor:
        - 'Ensure all callbacks are properly memoized'
    estimatedEffort: S

  - id: task-5
    title: 'Implement ControlCenterToolbar component'
    description: >
      Build the top toolbar panel with Add Feature and Auto-Layout buttons.
      Uses shadcn/ui Button components and Lucide icons inside a React Flow
      Panel positioned at top-left.
    state: Todo
    dependencies:
      - task-1
    acceptanceCriteria:
      - 'Renders inside <Panel position="top-left">'
      - 'Shows "Add Feature" button with Plus icon'
      - 'Shows "Auto-Layout" button with LayoutGrid icon (disabled)'
      - 'onAddFeature callback fires when Add Feature clicked'
      - 'Storybook stories: Default, WithCallbacks'
      - 'Unit tests verify rendering and callback invocation'
    tdd:
      red:
        - 'Write test: renders Add Feature button'
        - 'Write test: renders Auto-Layout button (disabled)'
        - 'Write test: calls onAddFeature when Add Feature clicked'
      green:
        - 'Implement toolbar with Panel, Button, and Lucide icons'
        - 'Wire onAddFeature to button onClick'
      refactor:
        - 'Add Storybook stories (Default, WithCallbacks)'
    estimatedEffort: S

  - id: task-6
    title: 'Implement ControlCenter orchestrator component'
    description: >
      Wire all sub-components together in the main ControlCenter component.
      Composes FeaturesCanvas and toolbar via useControlCenterState hook.
      Add comprehensive Storybook stories.
    state: Todo
    dependencies:
      - task-4
      - task-5
    acceptanceCriteria:
      - 'Renders FeaturesCanvas with nodes and edges'
      - 'Renders ControlCenterToolbar in top-left panel'
      - 'Passes onAddFeature callback to toolbar'
      - 'Escape key deselects node'
      - 'Storybook stories: Empty, WithFeatures, WithToolbar'
      - 'ControlCenter props: nodes, edges, onAddFeature, onNodeAction, onNodeSettings'
      - 'pnpm test passes for all control-center tests'
    tdd:
      red:
        - 'Write test: renders FeaturesCanvas with nodes and edges'
        - 'Write test: renders toolbar panel'
        - 'Write test: passes onAddFeature to toolbar'
      green:
        - 'Compose all sub-components inside ControlCenter'
        - 'Wire useControlCenterState for state management'
        - 'Pass interaction callbacks to FeaturesCanvas'
      refactor:
        - 'Add comprehensive Storybook stories'
        - 'Verify no unnecessary re-renders with React DevTools'
    estimatedEffort: M

  - id: task-7
    title: 'Build validation and final cleanup'
    description: >
      Run all build validation commands to ensure the feature compiles,
      lints, and builds correctly across all targets.
    state: Todo
    dependencies:
      - task-6
    acceptanceCriteria:
      - 'pnpm lint:web passes'
      - 'pnpm typecheck:web passes'
      - 'pnpm build:storybook passes'
      - 'pnpm build:web passes'
      - 'All unit tests pass (pnpm test:unit)'
      - 'Components follow tier import rules (013-ui-arch)'
    tdd: null
    estimatedEffort: S

# Total effort estimate
totalEstimate: M

# Open questions
openQuestions: []

# Markdown content (the full tasks document)
content: |
  ## Status

  - **Phase:** Implementation
  - **Updated:** 2026-02-12

  ## Task List

  ### Phase 1: Foundation

  - [ ] **task-1**: Scaffold control-center directory structure
    - Create `features/control-center/` with 5 files (component, hook, toolbar, stories, index)
    - Add minimal type-safe placeholder exports
    - Verify `pnpm typecheck:web` passes

  ### Phase 2: Existing Component Updates [P]

  #### 2A: FeatureNode Selected Highlight

  **RED (Write Failing Tests First):**

  - [ ] Write test: FeatureNode renders `ring-2 ring-primary` when `selected=true`
  - [ ] Write test: FeatureNode does NOT render ring classes when `selected=false`

  **GREEN (Implement to Pass Tests):**

  - [ ] Add conditional `cn()` class for ring highlight keyed on `selected` prop

  **REFACTOR (Clean Up):**

  - [ ] Verify ring integrates with existing `border-l-4` styles
  - [ ] Add Selected story variant to `feature-node.stories.tsx`

  #### 2B: FeaturesCanvas Interaction Callbacks

  **RED (Write Failing Tests First):**

  - [ ] Write test: FeaturesCanvas accepts and passes `onNodeClick` prop
  - [ ] Write test: FeaturesCanvas accepts and passes `onPaneClick` prop

  **GREEN (Implement to Pass Tests):**

  - [ ] Add `onNodeClick` and `onPaneClick` to `FeaturesCanvasProps`
  - [ ] Pass callbacks through to `<ReactFlow>` component

  **REFACTOR (Clean Up):**

  - [ ] Update type exports in index.ts
  - [ ] Add Interactive story variant

  ### Phase 3: State Management Hook

  **RED (Write Failing Tests First):**

  - [ ] Write test: returns selectedNode when FeatureNode selected
  - [ ] Write test: returns null when no selection
  - [ ] Write test: Escape key clears selection

  **GREEN (Implement to Pass Tests):**

  - [ ] Implement `useOnSelectionChange` for selection tracking
  - [ ] Add `useEffect` with keydown listener for Escape

  **REFACTOR (Clean Up):**

  - [ ] Ensure all callbacks properly memoized

  ### Phase 4: Toolbar

  **RED:**

  - [ ] Write test: renders Add Feature button
  - [ ] Write test: renders Auto-Layout button (disabled)
  - [ ] Write test: calls onAddFeature callback

  **GREEN:**

  - [ ] Implement toolbar with Panel, Button, Lucide icons

  **REFACTOR:**

  - [ ] Add Storybook stories (Default, WithCallbacks)

  ### Phase 5: Orchestrator Integration

  **RED:**

  - [ ] Write test: renders FeaturesCanvas with nodes and edges
  - [ ] Write test: renders toolbar panel
  - [ ] Write test: passes onAddFeature to toolbar

  **GREEN:**

  - [ ] Compose all sub-components in ControlCenter
  - [ ] Wire useControlCenterState hook
  - [ ] Connect callbacks and state

  **REFACTOR:**

  - [ ] Add comprehensive Storybook stories (Empty, WithFeatures, WithToolbar)
  - [ ] Verify no unnecessary re-renders

  ### Phase 6: Build Validation

  - [ ] `pnpm lint:web` passes
  - [ ] `pnpm typecheck:web` passes
  - [ ] `pnpm build:storybook` passes
  - [ ] `pnpm build:web` passes
  - [ ] All unit tests pass (`pnpm test:unit`)

  ## TDD Notes

  - **MANDATORY**: All phases with code follow RED -> GREEN -> REFACTOR
  - **RED**: Write failing tests FIRST (never skip this!)
  - **GREEN**: Write minimal code to pass tests
  - **REFACTOR**: Improve code while keeping tests green

  ## Progress Tracking (CRITICAL)

  - **Update checkboxes FREQUENTLY** - as soon as each item is complete!
  - **Don't batch updates** - check off items immediately, not at the end
  - **Commit task.md updates** along with code changes to show progress

  ## Acceptance Checklist

  Before marking feature complete:

  - [ ] All 7 tasks completed
  - [ ] Tests passing (`pnpm test`)
  - [ ] Linting clean (`pnpm lint:web`)
  - [ ] Types valid (`pnpm typecheck:web`)
  - [ ] Storybook builds (`pnpm build:storybook`)
  - [ ] Web builds (`pnpm build:web`)
  - [ ] Components follow tier import rules (013-ui-arch)
  - [ ] PR created and reviewed

  ---

  _Task breakdown for implementation tracking_
