# Feature: cicd-security-gates

> Parallel security scanning on PR branches with release-blocking gates on main

## Status

- **Number:** 003
- **Created:** 2026-02-02
- **Branch:** feat/docker-support
- **Phase:** Planning

## Problem Statement

The CI/CD pipeline lacks security scanning, leaving the codebase vulnerable to:

- Known vulnerabilities in dependencies (CVEs)
- Secrets accidentally committed to the repository
- Security anti-patterns in source code (SAST)
- Container image vulnerabilities
- Dockerfile misconfigurations

Without automated security gates, vulnerabilities can slip into production undetected.

## Success Criteria

- [ ] Security scanners run in parallel on all non-main branch pushes/PRs
- [ ] Security scan results visible in GitHub Actions logs
- [ ] On main branch, security failures block the release job
- [ ] Uses open-source tools only (no paid services)
- [ ] Minimal CI time impact (parallel execution)

## Proposed Security Stack

| Scanner      | Purpose                                             | Scope         |
| ------------ | --------------------------------------------------- | ------------- |
| **Trivy**    | Dependency vulnerabilities, container scanning, IaC | All-in-one    |
| **Gitleaks** | Secret detection in git history                     | Secrets       |
| **Semgrep**  | SAST for TypeScript/JavaScript                      | Code patterns |
| **Hadolint** | Dockerfile best practices                           | Container     |

## Workflow Design

```
Non-main branches (parallel, non-blocking release):
┌─────────┬──────────┬─────────┬───────────┐
│  Trivy  │ Gitleaks │ Semgrep │ Hadolint  │
└─────────┴──────────┴─────────┴───────────┘
         (single "security" job)

Main branch (blocking):
┌─────────────────────────────────────────────┐
│              Security Scan                   │
│  (same scanners, must pass before release)  │
└─────────────────────────────────────────────┘
                      ↓
              ┌───────────┐
              │  Release  │
              └───────────┘
```

## Affected Areas

| Area                       | Impact | Reasoning                                  |
| -------------------------- | ------ | ------------------------------------------ |
| `.github/workflows/ci.yml` | High   | Add security job, modify release needs     |
| `.semgrep.yml`             | New    | Semgrep rule configuration                 |
| `.trivyignore`             | New    | False positive suppressions (if needed)    |
| `.gitleaks.toml`           | New    | Secret detection configuration (if needed) |

## Dependencies

| Feature                   | Status   | Why Needed                                              |
| ------------------------- | -------- | ------------------------------------------------------- |
| 002-semantic-release-cicd | Complete | Security gates integrate with existing release pipeline |

## Size Estimate

**S** - Workflow configuration only, no application code changes.

## Open Questions

None - requirements are clear.

---

_Generated by `/shep-kit:new-feature` — proceed with `/shep-kit:research`_
