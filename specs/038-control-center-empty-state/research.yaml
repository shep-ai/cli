# Research Document (YAML)
# This is the source of truth. Markdown is auto-generated from this file.

name: control-center-empty-state
number: 038
branch: feat/038-control-center-empty-state

summary: >
  Conditional rendering in ControlCenterInner based on presence of repositoryNode
  nodes. No new libraries or architectural changes needed.

decisions:
  - title: Where to place the empty-state condition
    chosen: ControlCenterInner (derive hasRepositories from nodes state)
    rejected:
      - FeaturesCanvas (would couple generic canvas to repository semantics)
      - page.tsx (server-only; would not handle client-side repo deletion)
    rationale: >
      ControlCenterInner owns the nodes state and is the orchestrator for the
      Control Center feature. Deriving `hasRepositories` from the nodes array
      keeps the check reactive to both server props and client-side optimistic
      updates (add/delete repository). FeaturesCanvas remains a generic canvas
      component with no Control-Center-specific logic.

  - title: How to determine "no repositories"
    chosen: Check nodes.some(n => n.type === 'repositoryNode')
    rejected:
      - Check nodes.length === 0 (always fails since addRepositoryNode is present)
      - Track repository count in separate state (unnecessary extra state)
    rationale: >
      Directly checking the node type array is simple, reactive, and does not
      require additional state management. It correctly handles optimistic
      add/delete scenarios because handleAddRepository/handleDeleteRepository
      update the nodes array immediately.

technologies:
  - React (conditional rendering)
  - TypeScript

openQuestions: []

content: |
  ## Technology Decisions

  ### 1. Where to place the empty-state condition

  **Chosen**: `ControlCenterInner` — derive `hasRepositories` from the `nodes` state hook.

  **Options considered**:
  - **FeaturesCanvas**: Would require adding repository-specific logic to a generic canvas
    component. Rejected to preserve single-responsibility.
  - **page.tsx (server component)**: Only runs on initial load and router.refresh().
    Would not handle client-side optimistic repo deletion. Rejected for incomplete coverage.
  - **ControlCenterInner** (chosen): Owns the `nodes` state via `useControlCenterState`.
    The derived `hasRepositories` boolean reacts to both server prop changes and
    client-side optimistic updates.

  ### 2. How to determine "no repositories"

  **Chosen**: `nodes.some(n => n.type === 'repositoryNode')`

  The nodes array always contains an `addRepositoryNode`, so `nodes.length === 0` never
  triggers. Checking for the presence of `repositoryNode`-typed nodes is the correct
  semantic check and avoids coupling to array length.

  ## Security Considerations

  No security implications identified. This is a purely presentational change.

  ## Performance Implications

  No performance implications. The `nodes.some()` check runs on each render of
  ControlCenterInner, which is O(n) on node count — negligible for typical canvas sizes.

  ---

  _Generated by `/shep-kit:new-feature-fast`_
