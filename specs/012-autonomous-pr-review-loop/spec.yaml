# Feature Specification (YAML)
# This is the source of truth. Markdown is auto-generated from this file.

name: autonomous-pr-review-loop
number: 012
branch: feat/012-autonomous-pr-review-loop
oneLiner: Extend shep-kit:commit-pr to autonomously handle Claude Code bot review feedback until approval
summary: >
  Extends the existing shep-kit:commit-pr skill to close the loop between PR
  creation and review approval. After CI passes and the PR is created, the skill
  watches for Claude Code bot review comments via the GitHub API, parses
  actionable feedback, applies fixes locally, pushes updates, and repeats the
  watch-fix-push cycle until there are no remaining review issues. This turns
  the PR workflow from "create and hope" into a fully autonomous push-to-approval
  pipeline.
phase: planning
sizeEstimate: M

# Relationships
relatedFeatures:
  - '001-shep-kit'
  - '002-semantic-release-cicd'

technologies:
  - GitHub CLI (gh)
  - GitHub REST API (PR reviews, review comments)
  - Claude Code Action (claude-code-review workflow)
  - Shell scripting (SKILL.md extensions)

relatedLinks:
  - https://docs.github.com/en/rest/pulls/reviews
  - https://docs.github.com/en/rest/pulls/comments
  - https://cli.github.com/manual/gh_api

# Open questions (must be resolved before implementation)
openQuestions: []

# Markdown content (the actual spec)
content: |
  ## Problem Statement

  Today, `/shep-kit:commit-pr` creates a PR, watches CI until green, and stops.
  But the repo has a Claude Code review bot (`claude-code-review.yml`) that
  automatically reviews every PR. When that bot leaves comments requesting
  changes, a human must manually read the feedback, apply fixes, and push —
  breaking the autonomous flow.

  This feature extends the commit-pr skill to **automatically watch for bot
  review comments, parse the feedback, apply fixes, push, and loop** until the
  bot has no remaining issues. The result is a fully autonomous path from
  implementation to PR approval.

  ## Success Criteria

  - [ ] After CI passes, the skill polls for Claude Code bot review comments on the PR
  - [ ] Bot review comments are parsed into actionable items (file, line, suggested change)
  - [ ] The skill applies fixes locally based on parsed feedback
  - [ ] Fixed code is committed and pushed with a descriptive conventional commit message
  - [ ] The skill re-watches CI after each push (reusing existing CI watch loop)
  - [ ] The cycle repeats until the bot leaves no actionable feedback or approves
  - [ ] A configurable maximum iteration count prevents infinite loops (default: 5)
  - [ ] feature.yaml is updated with review loop state (iteration count, status)
  - [ ] The skill gracefully handles edge cases: no bot review, timeout, non-actionable comments
  - [ ] Existing commit-pr behavior is preserved — the review loop is an additive extension

  ## Affected Areas

  | Area | Impact | Reasoning |
  | ---- | ------ | --------- |
  | `.claude/skills/shep-kit:commit-pr/SKILL.md` | High | Core skill file being extended with the review loop workflow |
  | `.github/workflows/claude-code-review.yml` | Low | Read-only — we consume its output, no changes needed |
  | `docs/development/feature-yaml-protocol.md` | Medium | Document new review-loop checkpoints and phase transitions |
  | `docs/development/spec-driven-workflow.md` | Low | Update commit-pr section to mention review loop |

  ## Dependencies

  - Claude Code review bot must be configured and running on the repo (already in place via `claude-code-review.yml`)
  - `gh` CLI must be authenticated with permissions to read PR reviews and comments
  - The bot must post review comments in a parseable format (standard GitHub review comments)

  ## Size Estimate

  **M** - The core implementation is extending an existing SKILL.md with a new
  watch-parse-fix-push loop. No new TypeScript code or domain models are needed.
  The work is primarily in the skill definition (shell commands via `gh api`),
  feature.yaml protocol updates, and documentation. Medium because the parsing
  and fix-application logic requires careful prompt engineering in the skill
  instructions.

  ---

  _Generated by `/shep-kit:new-feature` — proceed with `/shep-kit:research`_
