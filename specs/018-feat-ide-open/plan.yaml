# Implementation Plan (YAML)
# This is the source of truth. Markdown is auto-generated from this file.

name: feat-ide-open
summary: Implementation plan for 018-feat-ide-open

# Relationships
relatedFeatures:
  - '006-cli-settings-commands'
technologies:
  - TypeScript
  - Commander.js
  - '@inquirer/prompts'
relatedLinks: []

# Structured implementation phases
phases:
  - id: phase-1
    name: 'TUI Prompt'
    parallel: false
    taskIds:
      - task-1
  - id: phase-2
    name: 'CLI Command (TDD)'
    parallel: false
    taskIds:
      - task-2
  - id: phase-3
    name: 'Wire Up & Verify'
    parallel: false
    taskIds:
      - task-3

# File change tracking
filesToCreate:
  - src/presentation/tui/prompts/ide-select.prompt.ts
  - src/presentation/cli/commands/settings/ide.command.ts
  - tests/unit/presentation/cli/commands/settings/ide.command.test.ts

filesToModify:
  - src/presentation/cli/commands/settings/index.ts

# Open questions (should all be resolved before implementation)
openQuestions: []

# Markdown content (the full plan document)
content: |
  ## Status

  - **Phase:** Planning
  - **Updated:** 2026-02-15

  ## Architecture Overview

  ```
  User -> `shep settings ide`
          |
          v
  ide.command.ts (interactive or --editor flag)
          |
          v
  ide-select.prompt.ts (TUI select: vscode/cursor/windsurf/zed)
          |
          v
  getSettings() -> mutate environment.defaultEditor
          |
          v
  UpdateSettingsUseCase.execute(settings) -> SQLite persist
          |
          v
  resetSettings() + initializeSettings() -> refresh singleton
          |
          v
  Success message (+ PATH warning if binary not found)
  ```

  ## Implementation Strategy

  **MANDATORY TDD**: All implementation phases with executable code follow RED-GREEN-REFACTOR cycles.

  ### Phase 1: TUI Prompt (No Tests)

  **Goal:** Create the IDE selection prompt configuration.

  **Steps:**

  1. Create `ide-select.prompt.ts` following `agent-select.prompt.ts` pattern
  2. Define choices: VS Code, Cursor, Windsurf, Zed with descriptions
  3. Use `shepTheme` for consistent styling

  **Deliverables:** IDE select prompt config function

  ### Phase 2: CLI Command (TDD Cycle)

  **Goal:** Implement `shep settings ide` command with interactive and non-interactive modes.

  **TDD Workflow:**

  1. **RED:** Write tests for ide.command.ts — interactive mode, --editor flag, PATH validation warning, Ctrl+C handling, settings persistence
  2. **GREEN:** Implement ide.command.ts following agent.command.ts pattern
  3. **REFACTOR:** Extract IDE binary map if needed

  **Deliverables:** Working `shep settings ide` command with full test coverage

  ### Phase 3: Wire Up & Verify

  **Goal:** Register command in settings group, verify end-to-end.

  **Steps:**

  1. Add `createIdeCommand()` to settings/index.ts
  2. Run `pnpm validate` to verify lint, types, tests
  3. Manual verification: `pnpm dev:cli -- settings ide`

  **Deliverables:** Fully integrated, passing CI

  ## Files to Create/Modify

  ### New Files

  | File | Purpose |
  | ---- | ------- |
  | `src/presentation/tui/prompts/ide-select.prompt.ts` | IDE selection prompt config |
  | `src/presentation/cli/commands/settings/ide.command.ts` | `shep settings ide` command |
  | `tests/unit/presentation/cli/commands/settings/ide.command.test.ts` | Unit tests for IDE command |

  ### Modified Files

  | File | Changes |
  | ---- | ------- |
  | `src/presentation/cli/commands/settings/index.ts` | Add `createIdeCommand()` to settings group |

  ## Testing Strategy (TDD: Tests FIRST)

  **CRITICAL:** Tests are written FIRST in each TDD cycle.

  ### Unit Tests (RED -> GREEN -> REFACTOR)

  Write FIRST for:
  - Interactive mode: calls select prompt, persists choice, refreshes singleton
  - Non-interactive mode: `--editor vscode` saves directly
  - PATH validation: warns when binary not found (non-blocking)
  - Error handling: Ctrl+C cancellation handled gracefully
  - Invalid editor: still saves (string is free-form)

  ### Integration Tests

  Not needed — UpdateSettingsUseCase and SQLite repository already have integration tests from 006-cli-settings-commands.

  ## Risk Mitigation

  | Risk | Mitigation |
  | ---- | ---------- |
  | `which` not available on Windows | Use `where` on Windows or skip validation with warning |
  | User enters unknown editor name | Accept any string, just warn about PATH |

  ---

  _Updated by `/shep-kit:plan` — see tasks.md for detailed breakdown_
