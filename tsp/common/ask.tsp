/**
 * Askable Pattern - Conversational AI Interface
 *
 * Defines the foundational request/response models and interface for
 * conversational AI interactions within the Shep AI platform. The Askable
 * pattern enables domain entities to participate in natural language
 * conversations with users and AI agents.
 *
 * ## Overview
 *
 * The Askable pattern provides a standardized way for the AI agent system
 * to interact with users through natural language queries. This enables:
 *
 * - **Requirements Gathering**: AI asks clarifying questions about features
 * - **Clarification Requests**: System requests additional context when needed
 * - **Interactive Planning**: Users can query and refine generated plans
 * - **Status Inquiries**: Natural language queries about task progress
 *
 * ## Architecture
 *
 * ```
 *   +----------+     AskRequest      +-----------+
 *   |          | ------------------> |           |
 *   |   User   |                     |  Askable  |
 *   |          | <------------------ |  Entity   |
 *   +----------+     AskResponse     +-----------+
 *                                          |
 *                                          v
 *                                   +-------------+
 *                                   |  AI Agent   |
 *                                   |  Processing |
 *                                   +-------------+
 * ```
 *
 * ## Usage
 *
 * Implement the `Askable` interface on any entity or service that should
 * support conversational interactions:
 *
 * ```typespec
 * import "./ask.tsp";
 *
 * @route("/features/{featureId}")
 * interface FeatureOperations extends Askable {
 *   // Feature-specific operations...
 * }
 * ```
 *
 * ## Design Rationale
 *
 * - **Simplicity**: Single query/response pattern covers most use cases
 * - **Consistency**: All conversational endpoints follow the same contract
 * - **Extensibility**: Response model can be enhanced without breaking changes
 * - **AI-Native**: Designed for LLM-based agent interactions
 *
 * @module common/ask
 * @see agents/agents.tsp - Agent nodes that implement Askable behaviors
 * @see domain/core.tsp - Feature entity that supports Ask operations
 */
/**
 * Request model for Ask operations.
 *
 * Represents a natural language query submitted by a user or AI agent
 * to an Askable endpoint. The query is processed by the underlying
 * AI system to generate an appropriate response.
 *
 * ## Query Guidelines
 *
 * Queries should be:
 * - Clear and specific to the context
 * - Written in natural language
 * - Scoped to the entity being queried
 *
 * ## Context
 *
 * The system automatically provides context based on:
 * - The entity being queried (Feature, Task, etc.)
 * - The current SDLC lifecycle stage
 * - Previous conversation history
 * - User permissions and role
 *
 * @example
 * ```typespec
 * // Defining an operation that accepts AskRequest
 * op askAboutFeature(@body request: AskRequest): AskResponse;
 * ```
 *
 * @example
 * ```json
 * // Asking about feature requirements
 * {
 *   "query": "What are the authentication requirements for this feature?"
 * }
 * ```
 *
 * @example
 * ```json
 * // Requesting clarification
 * {
 *   "query": "Should the login support both email and username?"
 * }
 * ```
 *
 * @example
 * ```json
 * // Querying task status
 * {
 *   "query": "What is the current progress on the API implementation?"
 * }
 * ```
 */
@doc("Request model for conversational AI interactions")
model AskRequest {
  /**
   * The natural language query to process.
   *
   * This string contains the user's question or request in natural
   * language. The AI agent will interpret this query in the context
   * of the entity being asked and generate an appropriate response.
   *
   * Queries can be:
   * - Questions about the entity's state or properties
   * - Requests for clarification or additional details
   * - Commands to perform actions (if supported by the entity)
   * - Freeform conversational inputs
   */
  @doc("The natural language query to be processed by the AI agent")
  query: string;
}

/**
 * Response model for Ask operations.
 *
 * Represents the AI-generated response to an AskRequest. Contains
 * the response content and a success indicator for error handling.
 *
 * ## Response Processing
 *
 * The response is generated by:
 * 1. Parsing the input query for intent
 * 2. Gathering relevant context from the entity
 * 3. Invoking the appropriate AI agent node
 * 4. Formatting the response for the user
 *
 * ## Error Handling
 *
 * When `success` is `false`:
 * - The `content` field contains an error message
 * - The client should display the error to the user
 * - The operation should be retried or escalated
 *
 * ## Content Format
 *
 * The `content` field typically contains:
 * - Markdown-formatted text for rich display
 * - Plain text for simple responses
 * - Structured data serialized as text when needed
 *
 * @example
 * ```typespec
 * // Using AskResponse in an operation
 * op ask(@body request: AskRequest): AskResponse;
 * ```
 *
 * @example
 * ```json
 * // Successful response
 * {
 *   "content": "The authentication requirements include:\n\n1. **OAuth2 Support**: Users can authenticate via Google, GitHub, or Microsoft\n2. **Email/Password**: Traditional login with email verification\n3. **MFA**: Optional two-factor authentication via TOTP\n\nWould you like me to elaborate on any of these?",
 *   "success": true
 * }
 * ```
 *
 * @example
 * ```json
 * // Error response
 * {
 *   "content": "Unable to process your query. The feature context is not available. Please ensure the feature exists and try again.",
 *   "success": false
 * }
 * ```
 */
@doc("Response model for conversational AI interactions")
model AskResponse {
  /**
   * The AI-generated response content.
   *
   * Contains the textual response to the user's query. This may include:
   * - Direct answers to questions
   * - Follow-up questions for clarification
   * - Explanations and elaborations
   * - Status updates and progress information
   * - Error messages when success is false
   *
   * The content is typically formatted as Markdown for rich display
   * in terminal and web interfaces.
   */
  @doc("The AI-generated response content (typically Markdown-formatted)")
  content: string;

  /**
   * Indicates whether the Ask operation completed successfully.
   *
   * - `true`: The query was processed successfully and content is valid
   * - `false`: An error occurred; content contains the error message
   *
   * Clients should check this field before processing the content
   * to handle errors appropriately.
   */
  @doc("Whether the operation completed successfully")
  success: boolean;
}

/**
 * Askable Interface
 *
 * Defines the contract for entities and services that support conversational
 * AI interactions. Any resource implementing this interface can participate
 * in natural language conversations with users and AI agents.
 *
 * ## Implementation
 *
 * To make a resource Askable:
 *
 * 1. Extend the Askable interface in your resource interface
 * 2. Implement the Ask operation handler
 * 3. Connect to the appropriate AI agent node
 *
 * ## HTTP Semantics
 *
 * The Ask operation is mapped to HTTP POST:
 * - **Method**: POST
 * - **Path**: `{resource-path}/ask`
 * - **Request Body**: AskRequest
 * - **Response Body**: AskResponse
 * - **Status**: 200 OK on success, 400/500 on errors
 *
 * ## Agent Integration
 *
 * The Askable interface integrates with the LangGraph-based agent system:
 *
 * ```
 * Askable.Ask()
 *     |
 *     v
 * +-------------------+
 * | StateGraph Router |
 * +-------------------+
 *     |
 *     +---> requirementsNode (gathering requirements)
 *     +---> planNode (explaining plans)
 *     +---> implementNode (status updates)
 *     +---> analyzeNode (codebase questions)
 * ```
 *
 * @example
 * ```typespec
 * // Making a Feature resource Askable
 * @route("/features/{id}")
 * interface FeatureResource extends Askable {
 *   @get
 *   get(@path id: UUID): Feature;
 *
 *   @put
 *   update(@path id: UUID, @body feature: Feature): Feature;
 *
 *   // Inherited from Askable:
 *   // @post @route("/ask") Ask(@body request: AskRequest): AskResponse;
 * }
 * ```
 *
 * @example
 * ```typespec
 * // Making the entire agent system Askable
 * @route("/agent")
 * interface AgentService extends Askable {
 *   @get
 *   @route("/status")
 *   getStatus(): AgentStatus;
 * }
 * ```
 */
@doc("Interface for entities supporting conversational AI interactions")
interface Askable {
  /**
   * Process a natural language query and return an AI-generated response.
   *
   * This operation accepts a user query in natural language, processes
   * it through the AI agent system, and returns an appropriate response.
   * The operation is context-aware, using the entity's current state
   * and conversation history to generate relevant responses.
   *
   * ## Processing Flow
   *
   * 1. Receive AskRequest with user query
   * 2. Load entity context and conversation history
   * 3. Route to appropriate AI agent node
   * 4. Generate response using LLM
   * 5. Return AskResponse with content
   *
   * ## Error Handling
   *
   * Errors are returned in the response body with `success: false`
   * rather than throwing HTTP errors, allowing for graceful degradation
   * and user-friendly error messages.
   */
  @doc("Process a natural language query and return an AI-generated response")
  Ask(request: AskRequest): AskResponse;
}
