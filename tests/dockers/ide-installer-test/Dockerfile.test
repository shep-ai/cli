# Quick test Dockerfile for testing cursor and cursor-cli fixes
FROM node:22-bookworm

# Install system dependencies
RUN apt-get update && apt-get install -y \
    sudo \
    curl \
    wget \
    git \
    gpg

# Install pnpm
RUN npm install -g pnpm

# Set shell and create global bin directory
ENV SHELL=/bin/bash \
    PATH="/root/.local/bin:$PATH"
RUN mkdir -p /root/.local/bin && \
    pnpm config set global-bin-dir /root/.local/bin

# Set working directory
WORKDIR /app

# Copy entire project
COPY . .

# Install dependencies and build
RUN echo "=== Installing dependencies ===" && \
    pnpm install && \
    echo "=== Building CLI ===" && \
    pnpm run build

# Make CLI globally available
RUN pnpm link --global && \
    echo "=== Verifying shep command ===" && \
    which shep

# Test cursor installation
RUN echo "=== Installing cursor ===" && \
    shep install cursor

RUN echo "=== Verifying cursor installation ===" && \
    cursor --version

# Test cursor-cli installation
RUN echo "=== Installing cursor-cli ===" && \
    shep install cursor-cli

RUN echo "=== Verifying cursor-cli installation ===" && \
    cursor-agent --version

# Test vscode (known working)
RUN echo "=== Installing vscode ===" && \
    shep install vscode

RUN echo "=== Verifying vscode installation ===" && \
    code --version --no-sandbox --user-data-dir=/tmp/vscode-test

RUN echo "=== Test completed successfully ==="
